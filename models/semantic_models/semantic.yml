semantic_models:
  - name: active_portfolio_dim
    model: ref('active_portfolio')
    description: This semantic model represents the active portfolio, including various financial and casefile-related attributes.
    
    defaults:
      agg_time_dimension: loan_taken_year

    entities:
      - name: id
        type: primary
      - name: debtor_id
        type: foreign
        expr: debtor_id
      - name: product_id
        type: foreign
        expr: product_id
    
    dimensions:
      - name: loan_taken_year
        type: time
        type_params:
          time_granularity: year
        label: Loan Taken Year
        expr: loan_taken_date
        
      - name: debtor_type
        type: categorical
        expr: debtor_type

      - name: debtor_gender
        type: categorical
        expr: debtor_gender

      - name: organization_country
        type: categorical
        expr: organization_country

      - name: sub_product_name
        type: categorical
        expr: sub_product

      - name: debt_type_name
        type: categorical
        expr: debt_type

      - name: collection_stage
        type: categorical
        expr: collection_stage

      - name: currency_name
        type: categorical
        expr: case_file_currency

      - name: country_name
        type: categorical
        expr: case_file_country

      - name: branch_name
        type: categorical
        expr: branch

      - name: contact_type
        type: categorical
        expr: contact_type

      - name: delinquency_reason_name
        type: categorical
        expr: delinquency_reason

      - name: dispute_reason_name
        type: categorical
        expr: dispute_reason
    
    measures:
      - name: total_loan_amount
        description: "Total amount of all loans in the active portfolio."
        agg: sum
        expr: loan_amount
      
      - name: total_arrears
        description: Total amount of arrears in the active portfolio
        agg: sum
        expr: arrears
      
      - name: total_payments
        description: Total amount of payments in the active portfolio
        agg: sum
        expr: total_payments
        label: Total payments
        create_metric: True

      - name: portfolio_count
        description: Total number of case files in the active portfolio
        agg: count_distinct
        expr: id
        label: Portfolio Count
        create_metric: True
      
      - name: total_principal_amount
        description: Total principal amount of all case files in active portfolio
        agg: sum
        expr: principal_amount
        create_metric: True
        label: Total Principal Amount