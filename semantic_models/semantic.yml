semantic_models:
  - name: active_portfolio_dim
    model: ref('active_portfolio')
    description: |
    This semantic model represents the active portfolio, including various financial and casefile-related attributes.
    
    defaults:
      agg_time_dimension:  loan_taken_month

    entities:
      - name: id
        type: primary
      - name: debtor_id
        type: foreign
        expr: debtor_id
      - name: product_id
        type: foreign
        expr: product_id
    
    dimensions:
      - name: loan_taken_month
        type: time
        type_params:
          time_granularity: month
        label: Loan Taken Month
        expr: taken_date
      - name: debtor_type
        type: string
        expr: debtor_type
      - name: debtor_gender
        type: string
        expr: debtor_gender
      - name: organization_country
        type: string
        expr: organization_country
      - name: sub_product_name
        type: string
        expr: sub_product
      - name: debt_type_name
        type: string
        expr: debt_type
      - name: collection_stage
        type: string
        expr: collection_stage
      - name: currency_name
        type: string
        expr: cur.currency
      - name country_name
        type: string
        expr: c.country
      - name: branch_name
        type: string
        expr: b.branch
      - name: contact_type
        type: string
        expr: ct.contact_type
      - name: delinquency_reason_name
        type: string
        expr: dr.delinquency_reason
      - name: dispute_reason_name
        type: string
        expr: dsr.dispute_reason
    
    measures:
      - name: total_amount
        description: "Total amount of all loans in the active portfolio."
        aggregation: sum
        expression: sum(loan_amount)
      